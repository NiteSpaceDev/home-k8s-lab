---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: cilium
  namespace: kube-system
spec:
  interval: 5m
  chart:
    spec:
      chart: cilium
      version: ">=1.18.0 <=1.19.0"
      sourceRef:
        kind: HelmRepository
        name: cilium
        namespace: kube-system
      interval: 1m
  values:
    prometheus:
      enabled: true
    ipam:
      mode: kubernetes
    hostFirewall:
      enabled: false
    hubble:
      relay:
        enabled: true
      ui:
        enabled: true
      peerService:
        clusterDomain: cluster.local
    etcd:
      clusterDomain: cluster.local
    securityContext:
      privileged: true
    capabilities:
      ciliumAgent:
      - CHOWN
      - KILL
      - NET_ADMIN
      - NET_RAW
      - IPC_LOCK
      - SYS_ADMIN
      - SYS_RESOURCE
      - DAC_OVERRIDE
      - FOWNER
      - SETGID
      - SETUID
      cleanCiliumState:
      - NET_ADMIN
      - SYS_ADMIN
      - SYS_RESOURCE
    kubeProxyReplacement: true
    cgroup:
      autoMount:
        enabled: false
      hostRoot: /sys/fs/cgroup
    k8sServiceHost: "192.168.5.5"
    k8sServicePort: "6443"
    kubeProxyReplacementHealthzBindAddr: "0.0.0.0:10256"
    k8sClientRateLimit:
      qps: 100
      burst: 500
    l2announcements:
      enabled: true
    externalIPs:
      enabled: true